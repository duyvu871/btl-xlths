<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>CandleStick with Line Chart</title>

    <style>
        
        #chart {
            max-width: 650px;
            margin: 35px auto;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>


    <script>
        // Replace Math.random() with a pseudo-random number generator to get reproducible results in e2e tests
        // Based on https://gist.github.com/blixt/f17b47c62508be59987b
        var _seed = 42;
        Math.random = function() {
            _seed = _seed * 16807 % 2147483647;
            return (_seed - 1) / 2147483646;
        };
    </script>
</head>

<body>
<div id="chart"></div>

<script>
    const options = {
        series: [{
            name: 'line',
            type: 'line',
            data: []
        }, {
            name: 'candle',
            type: 'candlestick',
            data: []
        }],
        chart: {
            height: 350,
            type: 'line',
        },
        title: {
            text: 'CandleStick Chart',
            align: 'left'
        },
        stroke: {
            width: [3, 1]
        },
        tooltip: {
            shared: true,
            custom: [function ({
                                   seriesIndex,
                                   dataPointIndex,
                                   w
                               }) {
                return w.globals.series[seriesIndex][dataPointIndex]
            }, function ({
                             seriesIndex,
                             dataPointIndex,
                             w
                         }) {
                var o = w.globals.seriesCandleO[seriesIndex][dataPointIndex]
                var h = w.globals.seriesCandleH[seriesIndex][dataPointIndex]
                var l = w.globals.seriesCandleL[seriesIndex][dataPointIndex]
                var c = w.globals.seriesCandleC[seriesIndex][dataPointIndex]
                return (
                    '<div class="apexcharts-tooltip-candlestick">' +
                    '<div>Open: <span class="value">' +
                    o +
                    '</span></div>' +
                    '<div>High: <span class="value">' +
                    h +
                    '</span></div>' +
                    '<div>Low: <span class="value">' +
                    l +
                    '</span></div>' +
                    '<div>Close: <span class="value">' +
                    c +
                    '</span></div>' +
                    '</div>'
                )
            }]
        },
        xaxis: {
            type: 'datetime'
        }
    };

    const chart = new ApexCharts(document.querySelector("#chart"), options);
    chart.render();

    fetch('/api/v1/get-candlestick-data')
        .then(response => response.json())
        .then(data => {
            chart.updateSeries([{
                name: 'line',
                data: data.line
            }, {
                name: 'candle',
                data: data.candle
            }])
        })
        .catch(error => {
            console.error('There was an error!', error);
        });

</script>

</body>

</html>